<!DOCTYPE html>
<html>  
  <head>
    <meta charset=utf-8>
    <h1>WsConnection Test Page</h1>
    <script src='FmCore.js'></script>   
    <script src='WsConnection.js'></script>   
  </head>
  <body>
    <script>
      (function(global, $) {
        var rpcSuccess = JSON.stringify({id: 1, 
                                         method: 'wsSuccess', 
                                         params: [{magicNumber: 42}]}),
            rpcError = JSON.stringify({id: 2, 
                                       method: 'wsError', 
                                       params: [{magicNumber: 42}]}),                 
            connection = $.fm.ws.makeConnection('perry', 17500, 'ws-server', {
              onError: function(error) {
                global.console.log('onError: ' + error);
              },
              onConnectionOpened: function() {
                global.console.log('onConnectionOpened');
                connection.send(rpcSuccess);
                connection.send(rpcError);
              },
              onMessageSent: function(message) {
                global.console.log('onMessageSent: ' + message);
              },
              onMessageReceived: function(message) {
                global.console.log('onMessageReceived: ' + message);
              },
              onConnectionClosed: function() {
                global.console.log('onConnectionClosed');                
              }
            });
            
        connection.open();        
      })(this, (this.jQuery || this));
    </script>   
  </body>
</html>
