<!DOCTYPE html>
<html>  
  <head>
    <meta charset=utf-8>
    <h1>WebSockets Client Test Page</h1>
    <script src='FmCore.js'></script>   
    <script src='WsConnection.js'></script>   
  </head>
  <body>
    <script>
      (function(global, $) {
        var attempts = 0,         
            connection = $.fm.ws.makeConnection('perry', 17500, 'ws-server', {
              onError: function(error) {
                global.console.log('onError: ' + error);
              },
              onRetryConnect: function(error) {
                global.console.log('onRetryConnect: ' + error);                
                attempts = attempts + 1;
                
                if (attempts < 5) {
                  global.console.log('Retry to connect...');                
                  
                  return true;
                } else {
                  global.console.log('Close connection!');
                  
                  return false;
                }                               
              },
              onMessageSent: function(message) {
                global.console.log('onMessageSent: ' + message);
              },
              onMessageReceived: function(message) {
                global.console.log('onMessageReceived: ' + message);
              },
              onConnectionClosed: function() {
                global.console.log('onConnectionClosed');                
              }
            }),
            rpcSuccess = JSON.stringify({id: 1, 
                                         method: 'wsSuccess', 
                                         params: [{magicNumber: 42}]}),
            rpcError = JSON.stringify({id: 2, 
                                       method: 'wsError', 
                                       params: [{magicNumber: 42}]});
        
        connection.open();
        connection.send(rpcSuccess);
        connection.send(rpcError);
      })(this, (this.jQuery || this));
    </script>   
  </body>
</html>
