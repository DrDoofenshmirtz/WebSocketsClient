<!DOCTYPE html>
<html>  
  <head>
    <meta charset=utf-8>
    <h1>WebSockets Client Test Page</h1>
    <script src='FmCore.js'></script>   
    <script src='WsConnection.js'></script>   
  </head>
  <body>
    <script>
      (function(global, $) {
        var attempts = 0,         
            connection = $.fm.ws.makeConnection('perry', 17500, 'ws-server', {
              onError: function(error) {
                global.console.log('onError: ' + error);
              },
              onRetryConnect: function(error) {
                global.console.log('onRetryConnect: ' + error);                
                attempts = attempts + 1;
                
                if (attempts < 5) {
                  global.console.log('Retry to connect...');                
                  
                  return true;
                } else {
                  global.console.log('Close connection!');
                  
                  return false;
                }                               
              },
              onMessageSent: function(message) {
                global.console.log('onMessageSent: ' + message);
              },
              onMessageReceived: function(message) {
                global.console.log('onMessageReceived: ' + message);
              }
            });
        
        connection.open();
        connection.send('ABC');
        connection.send('DEF');
        connection.send('GHI');
      })(this, (this.jQuery || this));
    </script>   
  </body>
</html>

